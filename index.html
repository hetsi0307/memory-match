<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Glass Memory Match — Play Free</title>
<meta name="description" content="A slick glassmorphism memory game with voice, keyboard & controller support.">

<!-- PWA manifest & icons (icons are in repo root) -->
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#0a0f21">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="icon" href="icon-192.png">

<!-- (optional) social preview -->
<meta property="og:title" content="Glass Memory Match">
<meta property="og:description" content="Play by voice, keyboard, touch or gamepad.">
<meta property="og:image" content="icon-512.png">

<style>
:root{
  --bg:#0a0f21; --bg2:#0b132e; --text:#eaf3ff; --muted:#a8b2ce;
  --accent:#66f2ff; --accent2:#98ffa7; --ring:rgba(255,255,255,.25);
}
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;color:var(--text);
  font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
  background:
    radial-gradient(1100px 700px at 75% -10%, #1b2554 0%, var(--bg) 60%),
    radial-gradient(900px 600px at -10% 110%, #122a4a 0%, var(--bg2) 60%);
}
.wrap{max-width:1100px;margin:0 auto;padding:28px}
header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
h1{margin:0;font-weight:800;letter-spacing:.3px}
.btn{
  background:linear-gradient(90deg,var(--accent2),var(--accent));
  color:#061020;border:0;border-radius:14px;padding:12px 18px;
  font-weight:800;cursor:pointer;box-shadow:0 10px 26px rgba(102,242,255,.25)
}
.ghost{
  background:rgba(255,255,255,.14);color:var(--text);
  border:1px solid var(--ring);backdrop-filter:saturate(140%) blur(10px);
  border-radius:14px;padding:10px 14px
}
.hero{display:grid;grid-template-columns:1.1fr .9fr;gap:28px;align-items:center;margin-top:28px}
.card{
  background:rgba(255,255,255,.12);border:1px solid var(--ring);
  backdrop-filter:saturate(140%) blur(12px);border-radius:18px;
  padding:20px;box-shadow:0 18px 40px rgba(0,0,0,.45)
}
.title{font-size:40px;line-height:1.1;margin:0 0 10px}
.muted{color:var(--muted)}
.cta{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:14px}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:18px}
.feature{
  background:rgba(255,255,255,.10);border:1px solid var(--ring);
  border-radius:14px;padding:14px;text-align:center
}
.shot{
  aspect-ratio:16/10;border-radius:16px;background:
  radial-gradient(60% 40% at 30% -10%, rgba(255,255,255,.08), transparent 60%),
  radial-gradient(60% 40% at 70% 110%, rgba(255,255,255,.06), transparent 60%),
  linear-gradient(180deg,#24345e,#182648)
}
footer{margin:34px 0 10px;color:var(--muted);text-align:center}

/* Voice UI */
.voice-controls{position:fixed;bottom:24px;right:24px;z-index:1000}
.voice-btn{
  width:64px;height:64px;border-radius:50%;
  background:linear-gradient(135deg,var(--accent2),var(--accent));
  border:3px solid rgba(255,255,255,.3);cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 12px 32px rgba(102,242,255,.4);
  transition:all .3s ease;font-size:28px
}
.voice-btn:hover{transform:scale(1.08);box-shadow:0 16px 40px rgba(102,242,255,.6)}
.voice-btn.listening{animation:pulse 1.5s infinite;background:linear-gradient(135deg,#ff6b6b,#ff8e53)}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.voice-indicator{
  position:absolute;top:-40px;right:0;background:rgba(255,255,255,.95);color:#061020;
  padding:8px 16px;border-radius:20px;font-size:13px;font-weight:600;white-space:nowrap;
  box-shadow:0 4px 12px rgba(0,0,0,.3);opacity:0;transition:opacity .3s
}
.voice-indicator.show{opacity:1}
.voice-status{
  position:absolute;bottom:90px;right:0;background:rgba(255,255,255,.12);
  backdrop-filter:blur(12px);border:1px solid var(--ring);border-radius:12px;
  padding:12px 16px;min-width:220px;opacity:0;transition:opacity .3s;
  color:var(--text);font-size:14px
}
.voice-status.show{opacity:1}

@media (max-width:900px){.hero{grid-template-columns:1fr}.grid{grid-template-columns:1fr 1fr}}
@media (max-width:560px){
  .grid{grid-template-columns:1fr}
  .voice-controls{bottom:16px;right:16px}
  .voice-btn{width:56px;height:56px;font-size:24px}
}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Glass Memory Match</h1>
    <div class="actions">
      <button id="installBtn" class="ghost" hidden>Install App</button>
      <a class="ghost" href="./aigameglass.html">Skip to Game</a>
    </div>
  </header>

  <section class="hero">
    <div class="card">
      <h2 class="title">A sleek memory game you can play by <em>voice</em>, <em>keys</em> or <em>gamepad</em>.</h2>
      <p class="muted">Glassmorphism UI, dark/light mode, spoken prompts, and gentle background music. Installable as a PWA.</p>
      <div class="cta">
        <a class="btn" href="./aigameglass.html">Play Now</a>
        <a class="ghost" href="#about">How it works</a>
      </div>
      <div class="grid">
        <div class="feature">🎙 Voice control</div>
        <div class="feature">🎮 Controller support</div>
        <div class="feature">🌓 Dark/Light</div>
        <div class="feature">🧊 Glass UI</div>
        <div class="feature">⚡ PWA offline</div>
        <div class="feature">🔊 Spoken prompts</div>
      </div>
    </div>
    <div class="card">
      <div class="shot"></div>
      <p class="muted" style="margin:.7rem 0 0">Preview — the full game opens when you click <b>Play Now</b>.</p>
    </div>
  </section>

  <section id="about" style="margin-top:28px">
    <div class="card">
      <h3 style="margin:0 0 8px">How to play</h3>
      <ul>
        <li>Flip two tiles to find matching pairs.</li>
        <li>Use voice (say "play now", "install app", "help"), keyboard arrows + Enter, or a gamepad.</li>
        <li>Switch themes, toggle music, and try Difficult mode for more tiles.</li>
      </ul>
    </div>
  </section>

  <footer>© HETSI TEWAR — Built with HTML/CSS/JS</footer>
</div>

<!-- Voice Controls -->
<div class="voice-controls">
  <div class="voice-indicator" id="voiceIndicator" aria-live="polite"></div>
  <div class="voice-status" id="voiceStatus" aria-live="polite"></div>
  <button class="voice-btn" id="voiceBtn" title="Click or press V to talk" aria-label="Voice control">🎤</button>
</div>

<script>
// --- Service Worker registration ---
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js', { scope: './' })
      .then(reg => console.log('✅ SW:', reg.scope))
      .catch(err => console.error('❌ SW failed:', err));
  });
}

// --- PWA install prompt ---
let deferredPrompt;
const installBtn = document.getElementById('installBtn');
installBtn.hidden = true;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.hidden = false;
  installBtn.textContent = "Install App";
});
installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  await deferredPrompt.userChoice;
  deferredPrompt = null;
  installBtn.hidden = true;
});
if (window.matchMedia('(display-mode: standalone)').matches) installBtn.hidden = true;

// ===== Voice User Interface =====
const voiceBtn = document.getElementById('voiceBtn');
const voiceIndicator = document.getElementById('voiceIndicator');
const voiceStatus = document.getElementById('voiceStatus');

let recognition = null;
let isListening = false;
let continuousMode = false;
const synth = window.speechSynthesis;

// TTS helper (used by welcome + feedback)
function speak(text) {
  if (!('speechSynthesis' in window)) { showStatus(`🔊 ${text}`); setTimeout(hideStatus, 2000); return; }
  synth.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.rate = 1.0; u.pitch = 1.0; u.volume = 1.0;
  showStatus(`🔊 ${text}`);
  u.onend = () => setTimeout(hideStatus, 1600);
  synth.speak(u);
}

// Init Speech Recognition (Chrome/Edge desktop + some Android)
if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-US';

  recognition.onstart = () => {
    isListening = true;
    voiceBtn.classList.add('listening');
    voiceBtn.textContent = '🎙️';
    showIndicator('Listening…');
  };
  recognition.onend = () => {
    isListening = false;
    voiceBtn.classList.remove('listening');
    voiceBtn.textContent = '🎤';
    hideIndicator();
    if (continuousMode) setTimeout(() => { try { recognition.start(); } catch(e){} }, 250);
  };
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript.toLowerCase().trim();
    console.log('Heard:', transcript);
    showStatus(`You said: “${transcript}”`);
    processVoiceCommand(transcript);
  };
  recognition.onerror = (event) => {
    console.warn('Speech error:', event.error);
    showStatus(`Error: ${event.error}`);
    setTimeout(hideStatus, 2000);
  };
} else {
  // No speech recognition (iOS Safari etc.)
  voiceBtn.style.display = 'none';
}

// Toggle mic by button
voiceBtn.addEventListener('click', () => {
  if (!recognition) return;
  if (isListening) recognition.stop(); else recognition.start();
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  const k = e.key.toLowerCase();
  if (k === 'v') voiceBtn.click();          // toggle voice
  else if (k === 'p') navigateToGame();     // play
  else if (k === 'i' && !installBtn.hidden) installBtn.click(); // install
});

// Command handler
function processVoiceCommand(raw) {
  const cmd = raw.replace(/[.,!?]/g, '').trim();

  if (cmd.includes('hey game') || cmd.includes('hi game') || cmd.includes('ok game')) {
    continuousMode = true; speak("I'm listening"); return;
  }
  if (cmd.includes('stop listening') || cmd.includes('quiet')) {
    continuousMode = false; if (isListening && recognition) recognition.stop(); speak('Stopping listening'); return;
  }

  if (/(play now|play|start|begin|open game|go)$/.test(cmd)) {
    speak('Starting the game'); setTimeout(navigateToGame, 600); return;
  }

  if (cmd.includes('install') || cmd.includes('download app') || cmd.includes('add to home')) {
    if (!installBtn.hidden) { speak('Installing app'); installBtn.click(); }
    else { speak('Install is not available or already installed'); }
    return;
  }

  if (cmd === 'help' || cmd.includes('how it works') || cmd.includes('about') || cmd.includes('instructions')) {
    speak('Say play now, install app, scroll down, scroll up, top, or bottom. You can also press V to toggle the mic.');
    document.getElementById('about').scrollIntoView({ behavior: 'smooth' });
    return;
  }

  if (cmd.includes('scroll down')) { window.scrollBy({ top: window.innerHeight*0.8, behavior:'smooth' }); return; }
  if (cmd.includes('scroll up'))   { window.scrollBy({ top:-window.innerHeight*0.8, behavior:'smooth' }); return; }
  if (cmd.includes('bottom'))      { window.scrollTo({ top: document.body.scrollHeight, behavior:'smooth' }); return; }
  if (cmd.includes('top') || cmd.includes('home') || cmd.includes('beginning')) {
    window.scrollTo({ top: 0, behavior:'smooth' }); return;
  }

  speak("Sorry, I didn't catch that. Try: play now, install app, help, scroll down.");
}

// Navigation helper
function navigateToGame(){ window.location.href = './aigameglass.html'; }

// UI helpers
function showIndicator(t){ voiceIndicator.textContent = t; voiceIndicator.classList.add('show'); }
function hideIndicator(){ voiceIndicator.classList.remove('show'); }
function showStatus(t){ voiceStatus.textContent = t; voiceStatus.classList.add('show'); }
function hideStatus(){ voiceStatus.classList.remove('show'); }

// --- One-line welcome on open (with mobile-friendly fallback) ---
const WELCOME_LINE = 'Welcome to Glass Memory Match. Tap Play Now to begin, or speak play.';
let welcomed = false;
function tryWelcome(){
  if (welcomed) return;
  welcomed = true;
  speak(WELCOME_LINE);
}
window.addEventListener('load', () => {
  if (!('speechSynthesis' in window)) return;
  const s = window.speechSynthesis;
  const fire = () => { tryWelcome(); };
  if (s.getVoices().length > 0) setTimeout(fire, 600);
  else s.addEventListener('voiceschanged', () => setTimeout(fire, 300), { once:true });
});
// Fallback if autoplay is blocked (common on mobile): first interaction
['click','touchstart','keydown'].forEach(evt => {
  window.addEventListener(evt, tryWelcome, { once:true, passive:true });
});
</script>
</body>
</html>
